<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>إدخال نتائج الطلاب وتحويلها إلى PDF</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            direction: rtl;
            background-color: #f4f4f4;
            margin: 20px;
        }
        select, input, button {
            margin: 10px;
            padding: 8px;
            font-size: 1rem;
        }
        table {
            margin-top: 20px;
            border-collapse: collapse;
            width: 100%;
            background-color: #fff;
            border: 1px solid #ddd;
        }
        th, td {
            padding: 10px;
            text-align: center;
            border: 1px solid #ddd;
        }
        th {
            background-color: #f2f2f2;
        }
        h1 {
            text-align: center;
        }
    </style>
</head>
<body>
    <h1>إدخال نتائج الطلاب</h1>

    <label for="subject">اختر المادة:</label>
    <select id="subject">
        <option value="1AS_العربية">1AS_العربية</option>
        <option value="2AS_العربية">2AS_العربية</option>
        <option value="3AS_العربية">3AS_العربية</option>
        <option value="4AS_العربية">4AS_العربية</option>
    </select>

    <br>
    <h3>إدخال نتائج الطلاب للمادة المختارة</h3>

    <label for="name">اسم الطالب:</label>
    <input type="text" id="name" placeholder="أدخل اسم الطالب">
    
    <label for="num">رقم الطالب:</label>
    <input type="number" id="num" placeholder="أدخل رقم الطالب">
    
    <label for="خ1">خ1:</label>
    <input type="number" id="خ1" placeholder="أدخل نتيجة خ1">
    
    <label for="خ2">خ2:</label>
    <input type="number" id="خ2" placeholder="أدخل نتيجة خ2">
    
    <label for="خ3">خ3:</label>
    <input type="number" id="خ3" placeholder="أدخل نتيجة خ3">
    
    <label for="ام1">ام1:</label>
    <input type="number" id="ام1" placeholder="أدخل نتيجة ام1">
    
    <label for="ام2">ام2:</label>
    <input type="number" id="ام2" placeholder="أدخل نتيجة ام2">
    
    <label for="ام3">ام3:</label>
    <input type="number" id="ام3" placeholder="أدخل نتيجة ام3">
    
    <button onclick="addResult()">إضافة النتيجة</button>
    <button onclick="saveToJSON()">حفظ البيانات</button>
    <button onclick="downloadPDF()">تنزيل PDF</button>

    <h3>نتائج المادة المختارة:</h3>
    <div id="results"></div>

    <script>
        let subjectData = {
            "1AS_العربية": [],
            "2AS_العربية": [],
            "3AS_العربية": [],
            "4AS_العربية": []
        };

        // تحميل ملف Excel من GitHub وتحويله إلى JSON
        async function loadExcelFile() {
            const subject = document.getElementById('subject').value;
            const fileUrl = `https://raw.githubusercontent.com/Ghadouri/Ghadouri/main/${subject}.xlsx`;
            const response = await fetch(fileUrl);
            const data = await response.arrayBuffer();
            const workbook = XLSX.read(data, { type: 'array' });
            const sheet = workbook.Sheets[workbook.SheetNames[0]];
            const jsonData = XLSX.utils.sheet_to_json(sheet);
            subjectData[subject] = jsonData;
            displayResults(subject);
        }

        // إضافة نتيجة الطالب إلى المادة المختارة
        function addResult() {
            const subject = document.getElementById('subject').value;
            const name = document.getElementById('name').value;
            const num = document.getElementById('num').value;
            const خ1 = parseInt(document.getElementById('خ1').value);
            const خ2 = parseInt(document.getElementById('خ2').value);
            const خ3 = parseInt(document.getElementById('خ3').value);
            const ام1 = parseInt(document.getElementById('ام1').value);
            const ام2 = parseInt(document.getElementById('ام2').value);
            const ام3 = parseInt(document.getElementById('ام3').value);

            // حساب المجموع والمعدل العام
            const المجموع = خ1 + خ2 + خ3 + ام1 + ام2 + ام3;
            const المعدل العام = المجموع / 6;

            // إضافة النتيجة للمادة المختارة
            subjectData[subject].push({
                الإسم: name,
                الرقم: num,
                خ1: خ1,
                خ2: خ2,
                خ3: خ3,
                ام1: ام1,
                ام2: ام2,
                ام3: ام3,
                المجموع: المجموع,
                المعدل العام: المعدل العام
            });

            // تحديث عرض النتائج
            displayResults(subject);
        }

        // عرض النتائج للمادة المختارة
        function displayResults(subject) {
            const resultsDiv = document.getElementById('results');
            const data = subjectData[subject];
            let tableHTML = "<table><tr><th>الإسم</th><th>الرقم</th><th>خ1</th><th>خ2</th><th>خ3</th><th>ام1</th><th>ام2</th><th>ام3</th><th>المجموع</th><th>المعدل العام</th></tr>";

            data.forEach(result => {
                tableHTML += `<tr>
                    <td>${result.الإسم}</td>
                    <td>${result.الرقم}</td>
                    <td>${result.خ1}</td>
                    <td>${result.خ2}</td>
                    <td>${result.خ3}</td>
                    <td>${result.ام1}</td>
                    <td>${result.ام2}</td>
                    <td>${result.ام3}</td>
                    <td>${result.المجموع}</td>
                    <td>${result.المعدل العام}</td>
                </tr>`;
            });
            tableHTML += "</table>";
            resultsDiv.innerHTML = tableHTML;
        }

        // حفظ البيانات في JSON
        function saveToJSON() {
            const subject = document.getElementById('subject').value;
            const data = subjectData[subject];
            const blob = new Blob([JSON.stringify(data)], { type: 'application/json' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `${subject}.json`;
            link.click();
        }

        // تحميل البيانات وتحويلها إلى PDF
        function downloadPDF() {
            const subject = document.getElementById('subject').value;
            const data = subjectData[subject];
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            doc.setFont("Arial");

            let yOffset = 10;
            doc.text(`نتائج مادة: ${subject}`, 10, yOffset);
            yOffset += 10;

            // إضافة رؤوس الأعمدة
            doc.text("الإسم", 10, yOffset);
            doc.text("الرقم", 40, yOffset);
            doc.text("خ1", 70, yOffset);
            doc.text("خ2", 90, yOffset);
            doc.text("خ3", 110, yOffset);
            doc.text("ام1", 130, yOffset);
            doc.text("ام2", 150, yOffset);
            doc.text("ام3", 170, yOffset);
            doc.text("المجموع", 190, yOffset);
            doc.text("المعدل العام", 210, yOffset);

            yOffset += 10;

            // إضافة بيانات الطلاب
            data.forEach(result => {
                doc.text(result.الإسم, 10, yOffset);
                doc.text(result.الرقم.toString(), 40, yOffset);
                doc.text(result.خ1.toString(), 70, yOffset);
                doc.text(result.خ2.toString(), 90, yOffset);
                doc.text(result.خ3.toString(), 110, yOffset);
                doc.text(result.ام1.toString(), 130, yOffset);
                doc.text(result.ام2.toString(), 150, yOffset);
                doc.text(result.ام3.toString(), 170, yOffset);
                doc.text(result.المجموع.toString(), 190, yOffset);
                doc.text(result.المعدل العام.toFixed(2).toString(), 210, yOffset);

                yOffset += 10;
            });

            doc.save(`${subject}_نتائج.pdf`);
        }

        // تحميل الملف عند بدء الصفحة
        loadExcelFile();
    </script>
</body>
</html>
